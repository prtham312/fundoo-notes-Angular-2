<!-- Entire card is now clickable for edit (unless in trash) -->
<div class="note-collapsed"
     (mouseenter)="hover = true"
     (mouseleave)="hover = false"
     [ngStyle]="{ 'background-color': color }"
     (click)="onCardClick($event)"
     [class.card-clickable]="context !== 'trash'">

  <!-- Select icon -->
  <mat-icon *ngIf="hover || isSelected"
            class="select-icon"
            (click)="toggleSelect($event); $event.stopPropagation()">
    {{ isSelected ? 'check_circle' : 'radio_button_unchecked' }}
  </mat-icon>

  <!-- Title and Pin -->
  <div class="note-header">
    <strong class="note-title-text" [innerHTML]="highlight(title)"></strong>

    <!-- âŒ Hide Pin in archive & trash -->
    <mat-icon
      *ngIf="context !== 'archive' && context !== 'trash'"
      fontSet="material-symbols-outlined"
      class="pin-icon"
      (click)="togglePin($event); $event.stopPropagation()"
      [class.pinned]="isPined"
    >push_pin</mat-icon>
  </div>

  <!-- Description -->
  <div class="note-body">
    <p [innerHTML]="highlight(description)"></p>
  </div>

  <!-- Footer icons pinned to bottom -->
  <div class="note-footer">
    <div class="footer-icons">

      <!-- ðŸ—‘ Trash Mode -->
      <ng-container *ngIf="context === 'trash'; else normalIcons">
        <mat-icon
          fontSet="material-symbols-outlined"
          (click)="onRestore(); $event.stopPropagation()"
          matTooltip="Restore"
        >restore_from_trash</mat-icon>

        <mat-icon
          fontSet="material-symbols-outlined"
          (click)="onDeleteForever(); $event.stopPropagation()"
          matTooltip="Delete forever"
        >delete_forever</mat-icon>
      </ng-container>

      <!-- Archive & Notes Mode: Full icons -->
      <ng-template #normalIcons>

        <!-- Color Palette -->
        <div class="palette-container">
          <mat-icon
            fontSet="material-symbols-outlined"
            (click)="toggleColorPalette(); $event.stopPropagation()"
            matTooltip="Background options"
          >palette</mat-icon>

          <div class="color-palette" *ngIf="showColorPalette">
            <div
              class="color-circle"
              *ngFor="let c of lightColors"
              [ngStyle]="{ 'background-color': c }"
              (click)="selectColor(c); $event.stopPropagation()">
            </div>
          </div>
        </div>

        <!-- Common Icons -->
        <mat-icon fontSet="material-symbols-outlined" (click)="$event.stopPropagation()" matTooltip="Remind me">add_alert</mat-icon>
        <mat-icon fontSet="material-symbols-outlined" (click)="$event.stopPropagation()" matTooltip="Collaborator">person_add</mat-icon>
        <mat-icon fontSet="material-symbols-outlined" (click)="$event.stopPropagation()" matTooltip="Add image">image</mat-icon>

        <!-- Archive/Unarchive -->
        <mat-icon
          *ngIf="context === 'archive'; else archiveBtn"
          fontSet="material-symbols-outlined"
          (click)="onUnarchive(); $event.stopPropagation()"
          matTooltip="Unarchive"
        >unarchive</mat-icon>

        <ng-template #archiveBtn>
          <mat-icon
            fontSet="material-symbols-outlined"
            (click)="onArchive(); $event.stopPropagation()"
            matTooltip="Archive"
          >archive</mat-icon>
        </ng-template>

        <!-- More Menu -->
        <button
          mat-icon-button
          [matMenuTriggerFor]="moreMenu"
          [matMenuTriggerRestoreFocus]="false"
          (click)="$event.stopPropagation()">
          <mat-icon fontSet="material-symbols-outlined">more_vert</mat-icon>
        </button>
      </ng-template>
    </div>
  </div>
</div>

<!-- Dropdown menu -->
<mat-menu #moreMenu="matMenu" class="small-menu">
  <button mat-menu-item (click)="onTrash(); $event.stopPropagation()">Delete note</button>
  <button mat-menu-item (click)="$event.stopPropagation()">Add label</button>
  <button mat-menu-item (click)="$event.stopPropagation()">Add drawing</button>
  <button mat-menu-item (click)="$event.stopPropagation()">Make a copy</button>
  <button mat-menu-item (click)="$event.stopPropagation()">Show checkboxes</button>
  <button mat-menu-item (click)="$event.stopPropagation()">Copy to Google Docs</button>
  <button mat-menu-item (click)="$event.stopPropagation()">Version history</button>
</mat-menu>
